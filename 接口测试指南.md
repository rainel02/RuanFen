# 接口测试指南

## 测试数据说明

已插入5个测试学者用户，所有用户的密码都是：`password123`

### 测试用户列表

| 用户ID | 用户名 | 邮箱 | 认证状态 | 学者姓名 | 机构 |
|--------|--------|------|----------|----------|------|
| 11111111-1111-1111-1111-111111111111 | zhang_san | zhangsan@university.edu.cn | CERTIFIED | 张三 | 清华大学计算机科学与技术系 |
| 22222222-2222-2222-2222-222222222222 | li_si | lisi@university.edu.cn | CERTIFIED | 李四 | 北京大学信息科学技术学院 |
| 33333333-3333-3333-3333-333333333333 | wang_wu | wangwu@university.edu.cn | PENDING | 王五 | 中科院计算技术研究所 |
| 44444444-4444-4444-4444-444444444444 | zhao_liu | zhaoliu@university.edu.cn | CERTIFIED | 赵六 | 上海交通大学电子信息与电气工程学院 |
| 55555555-5555-5555-5555-555555555555 | qian_qi | qianqi@university.edu.cn | CERTIFIED | 钱七 | 浙江大学计算机科学与技术学院 |

---

## 一、认证接口 (Auth)

### 1. POST `/api/auth/register` - 新用户注册

**前端测试方法：**
- 访问 `/profile` 页面（未登录状态）
- 切换到"注册"标签页
- 填写表单：
  - 用户名：`test_user_001`
  - 邮箱：`test001@example.com`
  - 密码：`password123`
- 点击"注册"按钮
- **预期结果**：显示绿色成功提示"注册成功，请登录"

**测试用例：**
- ✅ 正常注册
- ❌ 邮箱已被注册（使用已存在的邮箱）
- ❌ 密码不符合要求（太短）

---

### 2. POST `/api/auth/login` - 用户登录

**前端测试方法：**
- 访问 `/profile` 页面（未登录状态）
- 在"登录"标签页填写：
  - 账户：`zhangsan@university.edu.cn` 或 `zhang_san`
  - 密码：`password123`
- 点击"登录"按钮
- **预期结果**：登录成功，跳转到个人主页，导航栏显示用户头像

**测试用例：**
- ✅ 使用邮箱登录
- ✅ 使用用户名登录
- ❌ 错误的密码
- ❌ 不存在的账户

---

### 3. POST `/api/auth/forgot-password` - 忘记密码

**前端测试方法：**
- 在登录页面点击"忘记密码"链接（如果存在）
- 或直接调用 API：`POST /api/auth/forgot-password`，请求体：`{ "email": "zhangsan@university.edu.cn" }`
- **预期结果**：返回成功消息，提示验证码已发送

---

### 4. POST `/api/auth/reset-password` - 重置密码

**前端测试方法：**
- 调用 API：`POST /api/auth/reset-password`
- 请求体：
```json
{
  "email": "zhangsan@university.edu.cn",
  "verificationCode": "123456",
  "newPassword": "newpassword123"
}
```
- **预期结果**：密码重置成功

---

## 二、用户接口 (Users)

### 5. GET `/api/users/me` - 获取当前用户信息

**前端测试方法：**
- 登录后访问 `/profile` 页面
- 页面加载时会自动调用此接口
- **预期结果**：显示用户信息（用户名、邮箱、认证状态等）

**测试用例：**
- ✅ 已登录用户：正常返回用户信息
- ❌ 未登录用户：返回 401 未授权

---

### 6. PUT `/api/users/me` - 更新用户信息

**前端测试方法：**
- 登录后访问 `/profile` 页面
- 点击"编辑个人信息"按钮
- 修改用户名、邮箱等信息
- 点击"保存"
- **预期结果**：显示更新成功，个人信息刷新

---

### 7. POST `/api/users/me/certification` - 提交学者认证申请

**前端测试方法：**
- 登录后访问 `/profile` 页面
- 找到"学者认证"相关按钮或表单
- 填写认证信息：
  - 真实姓名：`张三`
  - 机构：`清华大学`
  - 机构邮箱：`zhangsan@tsinghua.edu.cn`
  - 职称：`教授`
  - 证明材料：上传文件（可选）
- 提交申请
- **预期结果**：显示"认证已提交"，状态变为"审核中"

---

### 8. GET `/api/users/me/certification` - 查看认证状态

**前端测试方法：**
- 登录后访问 `/profile` 页面
- 查看认证状态显示区域
- **预期结果**：显示当前认证状态（pending/certified/rejected）

**测试数据：**
- 用户 `zhangsan@university.edu.cn`：状态为 `certified`（已认证）
- 用户 `wangwu@university.edu.cn`：状态为 `pending`（审核中）

---

### 9. POST `/api/users/me/appeal` - 发起申诉

**前端测试方法：**
- 登录后访问 `/profile` 页面
- 找到"申诉"相关功能
- 填写申诉信息：
  - 申诉类型：`identity_stolen` 或 `achievement_stolen`
  - 目标ID：被申诉的学者或成果ID
  - 申诉理由：详细说明
  - 证据材料：上传文件（可选）
- 提交申诉
- **预期结果**：显示"申诉已提交"，返回申诉ID

---

## 三、学者门户接口 (Scholars)

### 10. GET `/api/scholars` - 检索学者门户

**前端测试方法：**
- 访问 `/scholars` 页面
- 页面加载时会自动调用此接口（无参数）
- **预期结果**：显示所有学者列表（至少5个学者）

**测试用例：**
- ✅ 无参数：返回所有学者
- ✅ 按姓名搜索：在搜索框输入"张三"，点击搜索
- ✅ 按机构筛选：选择"清华大学"
- ✅ 按研究领域筛选：选择某个领域
- ✅ 组合筛选：姓名 + 机构 + 领域

**测试数据：**
- 学者1：张三（清华大学）
- 学者2：李四（北京大学）
- 学者3：王五（中科院）
- 学者4：赵六（上海交大）
- 学者5：钱七（浙江大学）

---

### 11. GET `/api/scholars/{id}` - 浏览学者详情

**前端测试方法：**
- 访问 `/scholars` 页面
- 点击任意学者卡片
- 或直接访问：`/scholar/11111111-1111-1111-1111-111111111111`
- **预期结果**：显示学者详细信息（姓名、机构、简介、成果列表等）

**测试用例：**
- ✅ 访问已存在的学者：`/scholar/11111111-1111-1111-1111-111111111111`
- ❌ 访问不存在的学者：`/scholar/00000000-0000-0000-0000-000000000000`（应返回404）

**测试学者ID：**
- 张三：`11111111-1111-1111-1111-111111111111`
- 李四：`22222222-2222-2222-2222-222222222222`
- 王五：`33333333-3333-3333-3333-333333333333`
- 赵六：`44444444-4444-4444-4444-444444444444`
- 钱七：`55555555-5555-5555-5555-555555555555`

---

### 12. GET `/api/scholars/{id}/collaboration-network` - 查看合作网络

**前端测试方法：**
- 访问学者详情页面（如 `/scholar/11111111-1111-1111-1111-111111111111`）
- 找到"合作网络"或"Collaboration Network"部分
- 页面会自动调用此接口
- **预期结果**：显示合作网络图谱（ECharts图表），包含节点和连线

**测试数据说明：**
- 张三和李四合作过（共同发表论文1）
- 李四和王五合作过（共同发表论文2）
- 王五和赵六合作过（共同发表论文3）
- 赵六和钱七合作过（共同发表论文4）
- 钱七和张三合作过（共同发表论文5）

**测试用例：**
- ✅ 查看有合作关系的学者：张三、李四等
- ✅ 点击网络中的其他学者节点：应跳转到该学者详情页
- ❌ 查看没有合作关系的学者（如果存在）：应显示空网络或提示

---

## 四、管理员接口 (Admin)

### 13. GET `/api/admin/certifications` - 获取待审核认证列表

**前端测试方法：**
- 使用管理员账户登录
- 访问管理员后台页面（如果存在）
- 或直接调用 API：`GET /api/admin/certifications?status=pending`
- **预期结果**：返回待审核的认证申请列表

**测试数据：**
- 王五的认证申请状态为 `pending`（审核中）

---

### 14. POST `/api/admin/certifications/{appId}/approve` - 批准认证

**前端测试方法：**
- 管理员登录后，在认证审核页面
- 找到待审核的申请（如王五的申请）
- 点击"批准"按钮
- **预期结果**：认证状态变为"已批准"

**测试数据：**
- 申请ID：`cert2222-2222-2222-2222-222222222222`（王五的申请）

---

### 15. POST `/api/admin/certifications/{appId}/reject` - 驳回认证

**前端测试方法：**
- 管理员登录后，在认证审核页面
- 找到待审核的申请
- 点击"驳回"按钮
- 填写驳回理由
- **预期结果**：认证状态变为"已驳回"，并记录驳回理由

---

### 16. GET `/api/admin/appeals` - 获取申诉列表

**前端测试方法：**
- 管理员登录后，访问申诉管理页面
- 或调用 API：`GET /api/admin/appeals?status=pending`
- **预期结果**：返回待处理的申诉列表

---

### 17. POST `/api/admin/appeals/{caseId}/process` - 处理申诉

**前端测试方法：**
- 管理员登录后，在申诉管理页面
- 找到待处理的申诉
- 选择"批准"或"驳回"
- 填写处理理由
- 提交处理
- **预期结果**：申诉状态更新，并记录处理结果

---

### 18. GET `/api/admin/achievements/pending` - 获取待审核成果

**前端测试方法：**
- 管理员登录后，访问成果审核页面
- 或调用 API：`GET /api/admin/achievements/pending`
- **预期结果**：返回待审核的成果列表

---

### 19. POST `/api/admin/achievements/{achId}/approve` - 批准成果

**前端测试方法：**
- 管理员登录后，在成果审核页面
- 找到待审核的成果
- 点击"批准"按钮
- **预期结果**：成果状态变为"已批准"

---

### 20. POST `/api/admin/achievements/{achId}/reject` - 驳回成果

**前端测试方法：**
- 管理员登录后，在成果审核页面
- 找到待审核的成果
- 点击"驳回"按钮
- 填写驳回理由
- **预期结果**：成果状态变为"已驳回"

---

### 21. GET `/api/admin/tasks` - 查看定时任务

**前端测试方法：**
- 管理员登录后，访问任务管理页面
- 或调用 API：`GET /api/admin/tasks`
- **预期结果**：返回所有定时任务列表

---

### 22. PUT `/api/admin/tasks/{taskId}` - 配置定时任务

**前端测试方法：**
- 管理员登录后，在任务管理页面
- 找到要配置的任务
- 修改 Cron 表达式、状态等
- 保存配置
- **预期结果**：任务配置更新成功

---

### 23. POST `/api/admin/tasks/{taskId}/run` - 手动触发任务

**前端测试方法：**
- 管理员登录后，在任务管理页面
- 找到要执行的任务
- 点击"立即执行"或"手动触发"按钮
- **预期结果**：任务加入执行队列，返回成功消息

---

## 测试流程建议

### 基础功能测试流程

1. **注册和登录**
   - 注册新用户
   - 使用测试账户登录（zhangsan@university.edu.cn / password123）

2. **学者门户测试**
   - 访问学者列表页面
   - 搜索和筛选学者
   - 查看学者详情
   - 查看合作网络图谱

3. **用户功能测试**
   - 查看个人信息
   - 更新个人信息
   - 提交学者认证申请
   - 查看认证状态

4. **管理员功能测试**（需要管理员账户）
   - 查看待审核认证
   - 批准/驳回认证申请
   - 查看和处理申诉
   - 审核成果

---

## 注意事项

1. **密码哈希值**
   - 所有测试用户的密码都是 `password123`
   - 密码使用 BCrypt 加密存储

2. **UUID 格式**
   - 所有用户ID和学者ID都是 UUID 格式
   - 测试时请使用文档中提供的完整 UUID

3. **认证状态**
   - `NOT_CERTIFIED`：未认证
   - `PENDING`：审核中
   - `CERTIFIED`：已认证

4. **API 路径**
   - 前端开发环境：`http://localhost:5173/api/...`
   - 后端服务：`http://localhost:8080/api/...`
   - Apifox Mock：`http://127.0.0.1:4523/m1/7413325-7146674-6711292/api/...`

5. **CORS 配置**
   - 确保后端已配置 CORS，允许来自 `http://localhost:5173` 的请求

---

## 常见问题

### Q: 学者页面看不到任何学者？
**A:** 检查以下几点：
1. 数据库是否已执行测试数据插入语句
2. 后端服务是否正常运行
3. 前端 API 配置是否正确
4. 浏览器控制台是否有错误信息

### Q: 登录失败？
**A:** 检查：
1. 用户名/邮箱和密码是否正确（测试账户：zhangsan@university.edu.cn / password123）
2. 后端数据库连接是否正常
3. 密码哈希算法是否匹配

### Q: 合作网络图谱不显示？
**A:** 检查：
1. 学者是否有合作成果（achievement_authors 表中有数据）
2. ECharts 是否正确加载
3. API 返回的数据格式是否正确

---

## 测试数据重置

如果需要重置测试数据，可以：
1. 删除数据库中的所有数据
2. 重新执行 `scholar_platform.sql` 文件（包含测试数据）

---

**最后更新：** 2024-12-XX
**测试数据版本：** v1.0

